-- Configuration
local SERVER_URL = "https://cg62437.tw1.ru/verify.php"
local SECRET_KEY = "e8beea11-5080-43d3-8b12-c972a432266c"
local GITHUB_URL = "https://raw.githubusercontent.com/Idontknowhowtotype/NS2M/main/EXP"

-- Enhanced hash calculation with better fallback
local function GetContentHash(content)
    -- Try HashService first
    local success, hash = pcall(function()
        local h = game:GetService("HashService"):ComputeMD5Hash(content)
        return "secure_"..h -- Prefix to identify hash type
    end)
    
    -- Improved fallback for executors without HashService
    if not success then
        local simpleHash = 0
        -- Hash first 1000 characters for performance
        for i = 1, math.min(#content, 1000) do
            simpleHash = (simpleHash * 31 + string.byte(content, i)) % 2147483647
        end
        return "fallback_"..simpleHash
    end
    return hash
end

-- Phase 2: Content Verification (updated)
local function VerifyContent(sessionId)
    -- Download script content with retry logic
    local content
    for i = 1, 3 do -- Retry up to 3 times
        local success, err = pcall(function()
            content = game:HttpGet(GITHUB_URL, true)
        end)
        if success then break end
        if i == 3 then error("Failed to download script: "..tostring(err)) end
        wait(2^i) -- Exponential backoff
    end
    
    -- Calculate hash
    local hash = GetContentHash(content)
    print("Calculated hash:", hash) -- Debug output
    
    -- Verify with server
    local url = SERVER_URL.."?action=verify_content"..
        "&contentHash="..hash..
        "&sessionId="..sessionId..
        "&key="..SECRET_KEY
    
    local response
    for i = 1, 3 do -- Retry up to 3 times
        local success, err = pcall(function()
            response = game:HttpGet(url, true)
        end)
        if success then break end
        if i == 3 then error("Server request failed: "..tostring(err)) end
        wait(2^i) -- Exponential backoff
    end
    
    if response ~= "VERIFIED" then
        error("Phase 2 failed: "..tostring(response or "No response"))
    end
    
    return content
end

-- [Rest of the client script remains the same as previous]
